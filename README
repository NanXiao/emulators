
These were developed on Mac OS/Big Sur with QEMU installed. And you should
use at your own risk. No warranty. Anything that breaks, you get to
mop up and keep all the pieces.

See also: https://chrispinnock.com/stuff/running-systems-in-qemu/

You can install QEMU with Homebrew. e.g. "brew install qemu".
Or you can install it from the sources. It builds fine on Mac OS/Big Sur
provided you installed Ninja first.

Issues:

1. Make sure you are running Qemu >=5.2 if you want to run Sparc/Sparc64. I cannot get these to boot on 5.1.

2. I am not sure, but I think there is a bug in Qemu or MacOS. 
I've built it from scratch and used the Homebrew binaries. Large 
FTP transfers get interrupted.  This happens on all the architectures 
and both Net and OpenBSD. 

-------------------------------------------------------------------------
The setup script. 
-------------------------------------------------------------------------

./setup-qemu-vm.sh [OS [arch [ver [... other opts]]]]

This script sets up a VM image file in $HOME/QEmu/$OS, downloads the 
installer ISO and boots the VM into the installer. You can then
customise the installer to get the VM you want.

Once you've finished it is best to power down the VM. I usually do this
by exiting the installer and using "shutdown -p now".

With no options you get NetBSD/amd64.

Supported: 
* NetBSD/amd64, i386, sparc, sparc64
* OpenBSD/amd64, i386, sparc64
* FreeBSD/i386, amd64

Boots with caveats (see below):
* NetBSD/macppc 
* FreeBSD/sparc64
* Debian/amd64 - sort of works...

Does not work:
* OpenBSD/macppc - can get it to the bootloader but it panics staightaway

If the ISO file is already present, it will use it.
If the hard disc image is already present, it will use it.
In theory, it should be possible to use this script to upgrade the OS
in the VM.

------------------------------------------------------------------------
The run script. 
------------------------------------------------------------------------

Then:

./run-qemu-vm.sh [OS [arch [curses [other opts]]]]

will run the VM that you have setup previously.

By default it will run an amd64 VM (provided it has been setup).

------------------------------------------------------------------------
For NetBSD:
------------------------------------------------------------------------
You will need to set dhcpcd=YES in rc.conf. Then networking will work
on boot.

------------------------------------------------------------------------
NetBSD/Macppc
------------------------------------------------------------------------

The setup script will get you booted into the installer. You may want
to partition the filesystem to have an HFS partition which later you
can setup to boot from. For this you will need hfstools.

The run script will drop to a Boot prompt. You can boot by typing:
netbsd.macppc -a

The -a will instruct netbsd to ask you for the root filesystem - use wd0a
 
The run script needs the iso to be present on the filesystem.

You could put a kernel and OpenFirmware boot program on an iso image and
use this instead. 

DHCP will not work (I think due to the lack of BPF on the interface) -
you can setup a static IP. e.g. 10.0.2.100/255.255.255.0 gateway 10.0.2.2
and DNS 10.0.2.3.

------------------------------------------------------------------------
NetBSD/arm64
------------------------------------------------------------------------

* Use setup-arm64.sh to get the latest bits and pieces including 
working firmware and root filesystem. This will also resize the filesystem
to 10G
* Use run-arm64.sh to run it. Inside the script you can change the
graphics options easily if you prefer not to run headless

------------------------------------------------------------------------
FreeBSD/sparc64 12.2
------------------------------------------------------------------------

* Installs and boots, but I'm seeing segmentation faults for sshd and
sendmail programmes during boot.

------------------------------------------------------------------------
References:
------------------------------------------------------------------------
The sparc64 bit was based on work in this article:
* https://virtuallyfun.com/wordpress/2015/01/14/netbsd-6-1-5-sparc64-on-qemu/
* https://wiki.qemu.org/Documentation/Platforms/SPARC

This was helpful for MacPPC:
* https://wiki.qemu.org/Documentation/Platforms/PowerPC


------------------------------------------------------------------------
What doesn't work:
------------------------------------------------------------------------

OpenBSD/macppc panics
FreeBSD/powerpc panics on vgapci

I cannot get NetBSD/arc to boot but apparently others have had success.

